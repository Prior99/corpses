<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
		<script src="port.js"></script>
		<script src="js/websocket_client.js"></script>
		
	</head>
	<body>
		<div class="header">
			Welcome to the 7 days to die map for Land der toten Römmelbrömser
		</div>
		<div id="form">
			<div id="loginDiv">
				<span id="loginError" class="error"></span>
				Username: <input type="text" id="loginName"></input><br/>
				Password: <input type="text" id="loginPassword"></input><br/>
				<input type="checkbox" id="loginRemember" value="bla"> Remember my login data</input><br/>
				<button id="login">Login</button>
			</div>
			
			<div id="registerDiv" class="error">
				<span id="registerError"></span>
				Username: <input id="registerName"></input><br/>
				Steam64 ID: <input id="registerSteamID"></input> <a id="registerSteamIDHelp" class="tipstrip"> ? </a><span id="registerSteamIDHelpText" class="help">tolle help</span><br/>
				Password: <input id="registerPassword"></input> <a id="registerPasswordHelp" class="tipstrip"> ? </a><span id="registerPasswordHelpText" class="help">tolle help</span><br/>
				Repeated password: <input id="registerPasswordRepeat"></input><br/>
				<input type="checkbox" id="registerRemember"> Remember my login data</input><br/>
				<button id="register">Register</button>
			</div>
		</div>
		<div>
			<a href="#" id="gotoRegister"> Not registered jet? </a>
			<a href="#" id="gotoLogin"> I suddenly remembered my login! </a>
		</div>
		
		<script>
			function showRegister(animationLength){
				$(".help").hide();
				
				$("#gotoRegister").hide(animationLength);
				$("#gotoLogin").show(animationLength);
				
				$("#loginDiv").hide(animationLength);
				$("#registerDiv").show(animationLength);
			}
			
			function showLogin(animationLength){
				$(".help").hide();
				
				$("#gotoLogin").hide(animationLength);
				$("#gotoRegister").show(animationLength);
				
				$("#registerDiv").hide(animationLength);
				$("#loginDiv").show(animationLength);
			}
			
			function gotoMap(){
				window.location.href = "map.html";
			}
			
			function showHelp(markerID, show, animationLength){
				var span = $("#" + markerID + "Text");
				if(show){
					span.show(animationLength);
				}
				else{
					span.hide(animationLength);
				}
			}
			
			storeLoginData(remember, name, password){
				if(remember){
					localStorage.setItem("name", name);
					localStorage.setItem("password", password);
				}
			}
			
			retreiveLoginData(){
				if(localStorage.setItem["name"] !== undefined && password: localStorage["password"] !== undefined){
					return {
						name: localStorage.setItem["name"],
						password: localStorage["password"]
					};
				}
				else{
					return undefined;
				}
			}
			
			$(function(){
				showLogin(0);
				
				//Websocket.init();
				
				$(".tipstrip").hover(function(){ showHelp($(this).attr("id"), true, 100); }, function(){ showHelp($(this).attr("id"), false, 100); });
				
				$("#gotoRegister").click(function(){
					showRegister(100);
				});
				$("#gotoLogin").click(function(){
					showLogin(100);
				});
				
				$("#register").click(function(){
					Websocket.send("register", {
							name: $("#registerName").val(),
							steamid: $("#registerSteamID").val(),
							password: $("#registerPassword").val()
						},
						function(obj){
							if(obj.okay == true){
								storeLoginData($("#registerRemember").is(":checked"), $("#registerName").val(), $("#registerPassword").val());
								gotoMap();
							}
							else{
								$("#registerError").html(obj.reason);
							}
						}
					);
				});
				
				$("#login").click(function(){
					Websocket.send("login", {
							name: $("#loginName").val(),
							password: $("#loginPassword").val()
						},
						function(obj){
							if(obj.okay == true){
								storeLoginData($("#loginRemember").is(":checked"), $("#registerName").val(), $("#registerPassword").val());
								gotoMap();
							}
							else{
								$("#loginError").html(obj.reason);
							}
						}
					);
				});
				
				
			});
		</script>
	</body>
</html>